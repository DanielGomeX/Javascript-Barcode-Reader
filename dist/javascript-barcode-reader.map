{"version":3,"sources":["code-39\\index.js","ean-13\\index.js","index.js"],"names":["BAR_SET","GROUP_SET","CHAR_SET","decode","push","code","i","segment","lines","slice","barThreshold","Math","round","reduce","pre","item","length","noob","map","barSeg","filter","index","join","whiteSeg","parseInt","substring","module","exports","UPC_SET","bar","group","digits","reverse","indexOf","BARCODE_DECODERS","DecoderCode39","DecoderEAN13","barcodeDecoder","imgOrId","options","doc","document","img","getElementById","width","naturalWidth","height","naturalHeight","canvas","createElement","ctx","getContext","spoints","numLines","slineStep","drawImage","pxLine","getImageData","data","sum","min","max","row","col","g","s","undefined","pivot","bmp","matches","curr","count","barcode"],"mappings":"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","file":"javascript-barcode-reader.map","sourceRoot":"..\\src","sourcesContent":["const BAR_SET = {\r\n  '10001': '1',\r\n  '01001': '2',\r\n  '11000': '3',\r\n  '00101': '4',\r\n  '10100': '5',\r\n  '01100': '6',\r\n  '00011': '7',\r\n  '10010': '8',\r\n  '01010': '9',\r\n  '00110': '10',\r\n}\r\n\r\nconst GROUP_SET = {\r\n  '01000': '0',\r\n  '00100': '10',\r\n  '00010': '20',\r\n  '10000': '30',\r\n}\r\n\r\nconst CHAR_SET = [\r\n  '1',\r\n  '2',\r\n  '3',\r\n  '4',\r\n  '5',\r\n  '6',\r\n  '7',\r\n  '8',\r\n  '9',\r\n  '0',\r\n  'A',\r\n  'B',\r\n  'C',\r\n  'D',\r\n  'E',\r\n  'F',\r\n  'G',\r\n  'H',\r\n  'I',\r\n  'J',\r\n  'K',\r\n  'L',\r\n  'M',\r\n  'N',\r\n  'O',\r\n  'P',\r\n  'Q',\r\n  'R',\r\n  'S',\r\n  'T',\r\n  'U',\r\n  'V',\r\n  'W',\r\n  'X',\r\n  'Y',\r\n  'Z',\r\n  '-',\r\n  '.',\r\n  '␣',\r\n  '*',\r\n]\r\n\r\nconst decode = lines => {\r\n  // manualy push last white space\r\n  lines.push(3)\r\n  let code = ''\r\n\r\n  for (let i = 1; i < lines.length; i += 10) {\r\n    const segment = lines.slice(i, i + 10)\r\n\r\n    const barThreshold = Math.round(\r\n      segment.reduce((pre, item) => pre + item, 0) / segment.length\r\n    )\r\n\r\n    const noob = segment.map(item => (item > barThreshold ? 1 : 0))\r\n    const barSeg = noob.filter((item, index) => index % 2 === 0).join('')\r\n    const whiteSeg = noob.filter((item, index) => index % 2 !== 0).join('')\r\n\r\n    code +=\r\n      CHAR_SET[\r\n        parseInt(BAR_SET[barSeg], 10) - 1 + parseInt(GROUP_SET[whiteSeg], 10)\r\n      ]\r\n  }\r\n\r\n  return code.substring(1, code.length - 1)\r\n}\r\n\r\nmodule.exports = {\r\n  decode,\r\n}\r\n","const UPC_SET = {\r\n  '3211': '0',\r\n  '2221': '1',\r\n  '2122': '2',\r\n  '1411': '3',\r\n  '1132': '4',\r\n  '1231': '5',\r\n  '1114': '6',\r\n  '1312': '7',\r\n  '1213': '8',\r\n  '3112': '9',\r\n}\r\n\r\nconst decode = lines => {\r\n  let code = ''\r\n  // start indicator/reference lines\r\n  const bar = ~~((lines[1] + lines[2] + lines[3]) / 3) //eslint-disable-line\r\n\r\n  for (let i = 1; i < lines.length; i += 1) {\r\n    let group\r\n\r\n    if (code.length < 6) {\r\n      group = lines.slice(i * 4, i * 4 + 4)\r\n    } else {\r\n      group = lines.slice(i * 4 + 5, i * 4 + 9)\r\n    }\r\n\r\n    const digits = [\r\n      Math.round(group[0] / bar),\r\n      Math.round(group[1] / bar),\r\n      Math.round(group[2] / bar),\r\n      Math.round(group[3] / bar),\r\n    ]\r\n\r\n    code +=\r\n      UPC_SET[digits.join('')] || UPC_SET[digits.reverse().join('')] || 'X'\r\n\r\n    if (code.length === 12) {\r\n      return code\r\n      // eslint-disable-next-line\r\n      break\r\n    }\r\n  }\r\n  if (code.indexOf('X') === -1) {\r\n    return code || false\r\n  }\r\n\r\n  return false\r\n}\r\n\r\nmodule.exports = {\r\n  decode,\r\n}\r\n","import DecoderCode39 from './code-39'\r\nimport DecoderEAN13 from './ean-13'\r\n\r\nconst BARCODE_DECODERS = {\r\n  'code-39': DecoderCode39,\r\n  'ean-13': DecoderEAN13,\r\n}\r\n\r\nconst barcodeDecoder = (imgOrId, options) => {\r\n  const doc = document\r\n  const img =\r\n    typeof imgOrId === 'object' ? imgOrId : doc.getElementById(imgOrId)\r\n  const width = img.naturalWidth\r\n  const height = img.naturalHeight\r\n\r\n  const canvas = doc.createElement('canvas')\r\n  canvas.width = width\r\n  canvas.height = height\r\n  const ctx = canvas.getContext('2d')\r\n\r\n  // check points for barcode location\r\n  const spoints = [1, 9, 2, 8, 3, 7, 4, 6, 5]\r\n  let numLines = spoints.length\r\n  const slineStep = height / (numLines + 1)\r\n\r\n  ctx.drawImage(img, 0, 0)\r\n\r\n  // eslint-disable-next-line\r\n  while ((numLines -= 1)) {\r\n    // create section of height 2\r\n    const pxLine = ctx.getImageData(0, slineStep * spoints[numLines], width, 2)\r\n      .data\r\n    const sum = []\r\n    let min = 0\r\n    let max = 0\r\n\r\n    // grey scale section and sum of columns pixels in section\r\n    for (let row = 0; row < 2; row += 1) {\r\n      for (let col = 0; col < width; col += 1) {\r\n        const i = (row * width + col) * 4\r\n        const g = (pxLine[i] * 3 + pxLine[i + 1] * 4 + pxLine[i + 2] * 2) / 9\r\n        const s = sum[col]\r\n\r\n        pxLine[i] = g\r\n        pxLine[i + 1] = g\r\n        pxLine[i + 2] = g\r\n\r\n        sum[col] = g + (s === undefined ? 0 : s)\r\n      }\r\n    }\r\n\r\n    for (let i = 0; i < width; i += 1) {\r\n      sum[i] /= 2\r\n      const s = sum[i]\r\n\r\n      if (s < min) {\r\n        min = s\r\n      }\r\n      if (s > max) {\r\n        max = s\r\n      }\r\n    }\r\n\r\n    // matches columns in two rows\r\n    const pivot = min + (max - min) / 2\r\n    const bmp = []\r\n\r\n    for (let col = 0; col < width; col += 1) {\r\n      let matches = 0\r\n      for (let row = 0; row < 2; row += 1) {\r\n        if (pxLine[(row * width + col) * 4] > pivot) {\r\n          matches += 1\r\n        }\r\n      }\r\n      bmp.push(matches > 1)\r\n    }\r\n\r\n    // matches width of barcode lines\r\n    let curr = bmp[0]\r\n    let count = 1\r\n    const lines = []\r\n\r\n    for (let col = 0; col < width; col += 1) {\r\n      if (bmp[col] === curr) {\r\n        count += 1\r\n      } else {\r\n        lines.push(count)\r\n        count = 1\r\n        curr = bmp[col]\r\n      }\r\n    }\r\n\r\n    // TODO:  If not found in first step, continue searching until while loop\r\n\r\n    // Run the decoder\r\n    return BARCODE_DECODERS[options.barcode].decode(lines)\r\n  }\r\n  return false\r\n}\r\n\r\nif (typeof exports !== 'undefined') {\r\n  if (typeof module !== 'undefined' && module.exports) {\r\n    exports = barcodeDecoder\r\n    module.exports = barcodeDecoder\r\n  }\r\n  exports.barcodeDecoder = barcodeDecoder\r\n} else {\r\n  root.barcodeDecoder = barcodeDecoder\r\n}\r\n"]}